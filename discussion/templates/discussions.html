{% extends 'base.html' %}
{% block content %}
<h1>Discussions</h1>
{% if user.is_authenticated %}
<a href="{%url 'create_discussion' %}">Create Discussion</a>
{% endif %}
{% extends 'base.html' %}

{% block content %}
<h2>Discussions</h2>
<div id="discussion-list"></div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        fetch('/api/discussions/',{
            method: 'GET',
            headers: {
                'Content-Type': 'application/json',
            }
        })
        .then(response => response.json())
        .then(data => {
            const discussionList = document.getElementById('discussion-list');
            discussionList.innerHTML = data.map(discussion => `
                <h3><a href="/discussions/${discussion.id}/">${discussion.title}</a></h3>
                <p><strong>Categories:</strong> ${discussion.categories.join(', ')}</p>
                <small>By <a href="/profile/${discussion.author_username}/">@${discussion.author_username}</a> on ${new Date(discussion.created_at).toLocaleString()}</small>
                <hr>
            `).join('');
        })
        .catch(error => console.error('Error fetching discussions:', error));
    });
</script>
{% endblock %}